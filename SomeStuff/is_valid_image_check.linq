<Query Kind="Program">
  <Output>DataGrids</Output>
  <NuGetReference>ArchPM.FluentRabbitMQ</NuGetReference>
  <NuGetReference>ArchPM.NetCore</NuGetReference>
  <NuGetReference>Newtonsoft.Json</NuGetReference>
  <Namespace>System.Net.Http</Namespace>
  <Namespace>System.Threading.Tasks</Namespace>
  <Namespace>System.Drawing</Namespace>
</Query>

async Task Main()
{
	var validImageBytes = GetSampleValidImageBytes();
	var result = IsValidImage(validImageBytes);
	
	result.Dump();
}

public bool IsValidImage(byte[] bytes)
{
	var result = true;
	try
	{
		bytes.Length.Dump();
		using var ms = new MemoryStream(bytes);
		var image = Image.FromStream(ms);
		image.Dispose();
	}
	catch (ArgumentException)
	{
		result = false;
	}

	return result;
}

private byte[] GetSampleValidImageBytes() //todo: put this into a global place
{
	return new byte[]
	{
				137, 80, 78, 71, 13, 10, 26, 10, 0, 0, 0, 13, 73, 72, 68, 82, 0, 0, 0, 32, 0, 0, 0,
				32, 8, 6, 0, 0, 0, 115, 122, 122, 244, 0, 0, 4, 193, 73, 68, 65, 84, 120, 1, 197,
				151, 235, 79, 84, 87, 23, 198, 39, 121, 255, 167, 38, 253, 220, 214, 214, 152, 16,
				45, 151, 0, 53, 168, 169, 18, 41, 229, 82, 193, 14, 3, 76, 177, 94, 170, 198, 11,
				86, 241, 10, 131, 26, 193, 96, 169, 41, 45, 160, 197, 105, 133, 90, 130, 128, 17,
				52, 227, 109, 184, 13, 204, 0, 131, 216, 66, 185, 182, 225, 178, 158, 238, 181, 97,
				157, 156, 156, 156, 156, 28, 252, 208, 119, 37, 79, 246, 62, 129, 204, 250, 237,
				103, 173, 189, 206, 140, 7, 42, 86, 86, 86, 32, 43, 139, 136, 192, 193, 171, 252,
				109, 118, 126, 1, 165, 103, 3, 40, 254, 54, 128, 162, 242, 74, 45, 191, 218, 167,
				228, 23, 35, 41, 215, 16, 82, 247, 249, 49, 53, 51, 11, 183, 225, 145, 141, 0, 88,
				87, 137, 225, 241, 184, 78, 122, 254, 214, 79, 8, 118, 63, 195, 209, 170, 58, 134,
				81, 73, 75, 177, 167, 244, 40, 170, 26, 130, 40, 60, 113, 94, 67, 244, 15, 199, 96,
				27, 166, 67, 202, 222, 112, 192, 105, 125, 57, 56, 140, 237, 251, 191, 198, 145, 64,
				29, 150, 30, 148, 99, 54, 223, 131, 201, 222, 160, 1, 16, 254, 185, 30, 147, 73,
				255, 195, 84, 253, 17, 236, 42, 57, 142, 15, 51, 178, 240, 44, 220, 15, 23, 225, 12,
				32, 251, 222, 23, 125, 27, 6, 232, 126, 18, 114, 116, 64, 228, 129, 139, 16, 128,
				34, 149, 208, 77, 9, 12, 0, 231, 112, 15, 32, 37, 40, 174, 144, 6, 92, 107, 70, 127,
				197, 53, 213, 132, 165, 44, 105, 66, 222, 75, 9, 28, 29, 144, 102, 247, 192, 101,
				140, 189, 254, 67, 39, 244, 158, 190, 130, 45, 187, 178, 233, 253, 244, 221, 244,
				129, 210, 59, 155, 18, 180, 222, 221, 146, 136, 164, 28, 31, 82, 10, 202, 48, 24,
				29, 133, 203, 112, 15, 16, 25, 139, 43, 128, 0, 3, 144, 2, 128, 2, 128, 2, 128, 74,
				174, 165, 0, 136, 1, 216, 129, 23, 3, 17, 56, 197, 91, 57, 48, 183, 176, 200, 115,
				128, 93, 32, 182, 95, 137, 120, 175, 18, 178, 32, 107, 122, 97, 153, 227, 28, 176,
				54, 184, 7, 27, 15, 90, 90, 94, 230, 122, 235, 132, 236, 4, 107, 105, 105, 153, 176,
				241, 176, 7, 88, 93, 93, 69, 77, 99, 16, 190, 51, 87, 240, 251, 227, 16, 230, 23,
				255, 70, 201, 153, 74, 172, 157, 188, 210, 193, 129, 98, 176, 82, 191, 240, 99, 122,
				118, 14, 141, 173, 237, 72, 204, 243, 225, 100, 160, 150, 63, 211, 125, 9, 186, 67,
				175, 116, 50, 238, 250, 220, 111, 206, 34, 195, 123, 72, 143, 93, 73, 204, 55, 65,
				148, 148, 237, 149, 27, 32, 32, 90, 31, 237, 248, 12, 9, 89, 251, 144, 86, 176, 246,
				252, 75, 199, 35, 247, 37, 104, 235, 234, 149, 100, 2, 32, 207, 58, 233, 169, 154,
				31, 232, 97, 255, 56, 69, 231, 86, 169, 33, 78, 84, 221, 57, 68, 89, 199, 46, 106,
				16, 43, 128, 60, 223, 190, 247, 155, 189, 3, 214, 23, 17, 199, 253, 206, 30, 227,
				174, 215, 52, 255, 170, 110, 192, 132, 1, 112, 238, 86, 51, 70, 22, 128, 209, 127,
				214, 212, 28, 93, 68, 239, 211, 155, 104, 154, 0, 114, 203, 171, 145, 178, 14, 193,
				179, 227, 84, 245, 77, 153, 17, 10, 160, 213, 190, 7, 76, 137, 101, 165, 117, 0, 18,
				128, 161, 216, 184, 178, 93, 159, 158, 158, 79, 206, 147, 74, 76, 12, 17, 81, 107,
				188, 45, 153, 186, 122, 155, 168, 113, 2, 244, 93, 120, 22, 73, 159, 23, 17, 151,
				227, 89, 255, 16, 173, 3, 232, 103, 5, 64, 0, 200, 205, 40, 54, 3, 144, 25, 224,
				216, 213, 122, 26, 95, 2, 226, 203, 192, 168, 210, 244, 240, 13, 194, 77, 15, 130,
				177, 41, 220, 121, 3, 106, 153, 2, 118, 31, 44, 231, 132, 176, 0, 216, 58, 192, 0,
				82, 2, 39, 0, 50, 59, 176, 255, 228, 37, 136, 248, 127, 18, 178, 75, 177, 45, 219,
				203, 162, 109, 217, 133, 108, 183, 56, 0, 59, 7, 236, 75, 32, 178, 47, 129, 1, 112,
				224, 194, 117, 234, 84, 55, 228, 78, 251, 35, 134, 65, 123, 79, 136, 106, 154, 130,
				72, 206, 43, 193, 133, 186, 6, 250, 190, 165, 149, 223, 25, 102, 7, 172, 61, 64,
				114, 96, 183, 37, 96, 0, 12, 68, 199, 120, 47, 0, 164, 0, 200, 4, 64, 10, 128, 172,
				0, 161, 240, 128, 99, 15, 24, 37, 32, 34, 131, 70, 226, 190, 233, 26, 242, 64, 138,
				77, 76, 194, 87, 81, 165, 102, 193, 53, 227, 254, 203, 223, 57, 153, 245, 109, 200,
				226, 111, 69, 39, 2, 181, 242, 236, 124, 11, 36, 100, 223, 241, 228, 185, 154, 130,
				85, 122, 238, 215, 223, 107, 211, 228, 234, 93, 64, 59, 139, 14, 89, 147, 201, 40,
				102, 17, 175, 91, 247, 228, 96, 70, 77, 65, 21, 84, 81, 123, 91, 13, 162, 50, 93,
				162, 187, 15, 30, 194, 38, 236, 29, 56, 94, 121, 67, 200, 105, 239, 87, 199, 229,
				59, 1, 63, 155, 165, 62, 220, 12, 144, 73, 74, 122, 31, 122, 213, 175, 1, 210, 115,
				190, 196, 166, 237, 153, 90, 254, 147, 21, 238, 223, 5, 137, 57, 62, 92, 111, 184,
				139, 246, 199, 79, 137, 79, 48, 246, 250, 13, 133, 35, 35, 180, 126, 106, 74, 45,
				60, 32, 29, 45, 194, 230, 157, 123, 25, 128, 93, 160, 231, 125, 3, 136, 142, 199,
				105, 243, 142, 44, 106, 237, 232, 166, 203, 181, 245, 120, 47, 237, 83, 247, 37, 56,
				124, 161, 26, 151, 111, 53, 160, 181, 171, 135, 118, 249, 142, 128, 195, 12, 176,
				211, 119, 24, 146, 88, 214, 173, 153, 121, 226, 128, 6, 80, 65, 31, 103, 230, 163,
				165, 173, 157, 206, 4, 110, 192, 123, 236, 180, 251, 18, 240, 126, 48, 58, 166, 79,
				174, 126, 15, 232, 83, 154, 1, 50, 124, 7, 109, 0, 114, 12, 7, 4, 224, 47, 213, 11,
				49, 229, 68, 223, 208, 176, 124, 254, 219, 127, 35, 122, 21, 25, 49, 26, 143, 1, 44,
				193, 0, 144, 30, 96, 0, 183, 33, 14, 136, 254, 123, 0, 75, 210, 255, 15, 128, 27, 7,
				250, 34, 81, 227, 254, 103, 120, 15, 90, 123, 70, 3, 200, 149, 124, 57, 48, 100,
				247, 229, 195, 186, 186, 239, 129, 233, 153, 57, 248, 207, 93, 229, 193, 196, 210,
				67, 234, 98, 221, 143, 144, 40, 57, 125, 9, 201, 5, 37, 72, 203, 47, 211, 131, 231,
				19, 165, 201, 63, 167, 37, 145, 51, 128, 108, 156, 28, 8, 71, 98, 122, 236, 90, 37,
				193, 101, 177, 138, 127, 77, 57, 37, 222, 208, 45, 232, 121, 17, 102, 235, 173, 146,
				15, 100, 219, 173, 226, 159, 102, 182, 63, 245, 173, 32, 255, 2, 3, 164, 116, 202,
				226, 117, 136, 100, 0, 0, 0, 0, 73, 69, 78, 68, 174, 66, 96, 130
	};
}
